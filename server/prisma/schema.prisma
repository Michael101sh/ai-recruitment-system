generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// Represents a job candidate in the recruitment system
model Candidate {
  id         String   @id @default(uuid())
  firstName  String
  lastName   String
  email      String   @unique
  phone      String?
  yearsOfExp Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  cvs      CV[]
  skills   CandidateSkill[]
  rankings Ranking[]

  @@index([email])
  @@index([createdAt])
}

/// Stores AI-generated CVs for a candidate
model CV {
  id          String   @id @default(uuid())
  candidateId String
  content     String   @db.Text
  generatedBy String   @default("claude-sonnet-4")
  prompt      String?  @db.Text
  createdAt   DateTime @default(now())

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

/// Represents a skill that candidates can possess
model Skill {
  id       String @id @default(uuid())
  name     String @unique
  category String @default("technical")

  candidates CandidateSkill[]

  @@index([name])
}

/// Junction table for many-to-many relationship between Candidate and Skill
model CandidateSkill {
  candidateId String
  skillId     String
  level       Int    @default(5)

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  skill     Skill     @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@id([candidateId, skillId])
  @@index([candidateId])
  @@index([skillId])
}

/// Stores ranking results for candidates, produced by AI evaluation
model Ranking {
  id              String   @id @default(uuid())
  candidateId     String
  score           Int
  reasoning       String   @db.Text
  criteria        String
  shouldInterview Boolean  @default(true)
  priority        Int
  rankedAt        DateTime @default(now())

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([score])
  @@index([priority])
}
